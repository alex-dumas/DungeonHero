{"ts":1373383757903,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1373383961221,"patch":[[{"diffs":[[1,"/**\n *  @random-map.js\n *  @version: 1.00\n *  @author: Jesse Freeman\n *  @date: May 2012\n *\n *  This class creates a \"Random Map\" button in the weltmeister editor.\n *  It requires two layers, a collision layer named \"collation\" and your\n *  map layer named \"main\". The generator will automatically create the collision\n *  tiles.\n *\n *  You can manually load this plugin by including it into the weltmeister config.js\n *  requires block.\n *\n *  You will also need to supply a copy of ROT.js http://ondras.github.com/rot.js/hp/\n *\n */\nig.module(\n    'bootstrap.plugins.weltmeister.random-map-button'\n)\n    .requires(\n    'weltmeister.modal-dialogs'\n)\n    .defines(function () {\n        ModalDialogTest = wm.ModalDialog.extend({\n            pathDropdown:null,\n            pathInput:null,\n            fileType:'',\n            init:function (text, okText, type) {\n                this.fileType = type || '';\n                this.parent(text, (okText || 'Select'));\n            },\n            initDialog:function () {\n                this.parent();\n \n                this.buttonDiv.before(\"<dl><br/>\");\n \n                this.buttonDiv.before('<dt>Map Size:</dt><dd><input type=\"text\" class=\"number\" id=\"mapSizeX\" value=\"50\"> x <input type=\"text\" class=\"number\" id=\"mapSizeY\" value=\"50\"></dd>');\n \n                // \n                this.buttonDiv.before('<dt>Room Width:</dt><dd><input type=\"text\" class=\"number\" id=\"roomWidthX\" value=\"3\"> x <input type=\"text\" class=\"number\" id=\"roomWidthY\" value=\"9\"></dd>');\n \n                this.buttonDiv.before('<dt>Room Height:</dt><dd><input type=\"text\" class=\"number\" id=\"roomHeightX\" value=\"3\"> x <input type=\"text\" class=\"number\" id=\"roomHeightY\" value=\"5\"></dd>');\n \n \n                this.buttonDiv.before('<dt>Map Type:</dt><dd><select id=\"mapType\"><option value=\"DividedMaze\">Divided Maze</option><option value=\"IceyMaze\">Icey Maze</option><option value=\"EllerMaze\">Eller Maze</option><!--<option value=\"Cellular\">Cellular</option>--><option value=\"Digger\">Digger</option><option value=\"Uniform\">Uniform</option></select></dd>');\n \n \n                this.buttonDiv.before('<dt>Corridor Length:</dt><dd><input type=\"text\" class=\"number\" id=\"corridorLengthX\" value=\"3\"> x <input type=\"text\" class=\"number\" id=\"corridorLengthY\" value=\"10\"></dd>');\n \n                this.buttonDiv.before('<dt>Dug Percentage:</dt><dd><input type=\"text\" class=\"number\" id=\"dugPercentage\" value=\".2\"></dd>');\n \n                this.buttonDiv.before('<dt>Time Limit:</dt><dd><input type=\"text\" class=\"number\" id=\"timeLimit\" value=\"1000\"></dd>');\n \n                this.buttonDiv.before('<dt>Random Seed:</dt><dd><input type=\"text\" class=\"number\" id=\"randomSeed\" value=\"1234\"></dd>');\n \n                this.buttonDiv.before('<br/>');\n                //\n                this.buttonDiv.before('<dt>Wall Tiles:</dt><dd><input type=\"text\" class=\"text\" id=\"wallTiles\" value=\"0\"></dd>');\n                this.buttonDiv.before('<dt>Floor Tiles:</dt><dd><input type=\"text\" class=\"text\" id=\"floorTiles\" value=\"1\"></dd>');\n \n                //\n                this.buttonDiv.before('<dt>Target Layer:</dt><dd><input type=\"text\" class=\"text\" id=\"mapLayerID\" value=\"main\"></dd>');\n \n            },\n            clickOk:function () {\n                //console.log(\"Generate level\");\n                var mainLayerName = $(\"#mapLayerID\").val();\n                var collisionLayerName = \"collision\";//$(\"#collisionLayerID\").val();\n                var mainLayer = ig.editor.getLayerWithName(mainLayerName);\n                var collisionLayer = ig.editor.getLayerWithName(collisionLayerName);\n \n \n                // Create layers\n                if (!mainLayer)\n                    mainLayer = this.createLayer(mainLayerName);\n \n                if (!collisionLayer)\n                    collisionLayer = this.createLayer(collisionLayerName);\n \n                //var randomizer = new RandomMap($('#mapSize').val(), $('#roomSizeMax').val(), mainLayer, collisionLayer);\n \n                this.generateLevel(mainLayer, collisionLayer);\n \n                ig.editor.setActiveLayer(\"entities\");\n                mainLayer.resetDiv();\n                collisionLayer.resetDiv();\n \n                this.close();\n            },\n            createLayer:function (name) {\n                var tmpName = 'new_layer_' + ig.editor.layers.length;\n                ig.editor.addLayer();\n                var newLayer = ig.editor.getLayerWithName(tmpName);\n                newLayer.setName(name);\n                newLayer.resetDiv();\n                return newLayer;\n            },\n            generateLevel:function (targetLayer, collisionLayer) {\n                if (ROT.isSupported()) {\n \n                    var targetLayerData = targetLayer.data;\n                    var collisionLayerData = collisionLayer.data;\n \n                    targetLayerData.length = collisionLayerData.length = 0;\n \n                    //console.log(\"collisionLayer.data\", collisionLayer.data);\n \n \n                    ROT.RNG.setSeed($('#randomSeed').val());\n \n \n                    var map = new ROT.Map[$('#mapType').val()]($('#mapSizeY').val(), $('#mapSizeX').val(),\n                        {\n                            roomWidth:[Number($(\"#roomWidthX\").val()), Number($(\"#roomWidthY\").val())],\n                            roomHeight:[Number($(\"#roomHeightX\").val()), Number($(\"#roomHeightY\").val())],\n                            corridorLength:[Number($(\"#corridorLengthX\").val()), Number($(\"#corridorLengthY\").val())],\n                            dugPercentage:Number($(\"#dugPercentage\").val()),\n                            timeLimit:Number($(\"#timeLimit\").val())\n                        });\n \n                    map.create(function (x, y, wall) {\n                        if (!targetLayerData[x]) {\n                            targetLayerData[x] = [];\n                        }\n                        targetLayerData[x].push(wall ? $('#wallTiles').val() : $('#floorTiles').val());\n \n                        if (!collisionLayerData[x]) {\n                            collisionLayerData[x] = [];\n                        }\n                        collisionLayerData[x].push(wall ? 1 : 0);\n                    });\n \n                    targetLayer.width = collisionLayer.width = map._height;\n                    targetLayer.height = collisionLayer.height = map._width;\n \n                }\n            }\n        });\n    });\n \n \n$.getScript(\"lib/bootstrap/plugins/weltmeister/rot.js\", function (data, textStatus, jqxhr) {\n \n    // Load in ROT library, once lodaed add Random button and logic to map editor.\n \n    //Add buttons to map editor\n    $('.headerFloat').prepend('<input type=\"button\" id=\"randomize\" value=\"Generate Random Map\" class=\"button\"/>');\n    $('#randomize').bind('click', function () {\n        if (!ig.editor.testDialog) {\n            ig.editor.testDialog = new ModalDialogTest('Random Map Generator', 'Generate', 'scripts');\n        }\n        ig.editor.testDialog.open();\n    });\n \n});"]],"start1":0,"start2":0,"length1":0,"length2":6969}]],"length":6969,"saved":false}
{"ts":1373383987575,"patch":[[{"diffs":[[0,"lib/"],[-1,"bootstrap/"],[0,"plug"]],"start1":6407,"start2":6407,"length1":18,"length2":8}]],"length":6959,"saved":false}
{"ts":1373383990120,"patch":[[{"diffs":[[0,"ins/"],[-1,"weltmeister/"],[0,"rot."]],"start1":6415,"start2":6415,"length1":20,"length2":8}]],"length":6947,"saved":false}
{"ts":1373383996598,"patch":[[{"diffs":[[0,"   '"],[-1,"bootstrap."],[0,"plug"]],"start1":546,"start2":546,"length1":18,"length2":8}]],"length":6937,"saved":false}
{"ts":1373383998313,"patch":[[{"diffs":[[0,"plugins."],[-1,"weltmeister."],[0,"random-m"]],"start1":550,"start2":550,"length1":28,"length2":16}]],"length":6925,"saved":false}
